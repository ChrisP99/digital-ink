\chapter{Elastic Load Balancing (ELB)}\label{ch:elastic-load-balancing}

Elastic Load Balancing is used to automatically scale your EC2 instances to meet any changes in demand from your users.
ELB can be used to both scale up or down the instance's resources to ensure that your application is kept performant and
available regardless of how many users visit.
It is also possible to scale down the resources again, after the spike in usage has passed, to save money when it comes
to billing and ensure you aren't paying for any additional resources that are not being used.

1. Creation of new AMI

\begin{itemize}
    \item Selection of AMI previously created and then "Create Instance from AMI" option \begin{figure}[!htbp]
                                                                                             \centering
                                                                                             \includegraphics[width=\textwidth]{resources/elb/elb-instance-from-ami.png}
                                                                                             \caption{Creation of Instance from AMI Image}
                                                                                             \label{fig:elb-instance-from-ami}
                                                                                        \end{figure}
    \item AMI selected to use same instance as "Group4-EC2" so everything is the same \begin{figure}[!htbp]
                                                                                          \centering
                                                                                          \includegraphics[width=\textwidth]{resources/elb/elb-instance-2-name.png}
                                                                                          \caption{Elastic Load Balancing}
                                                                                          \label{fig:elb-instance-2-name}
                                                                                    \end{figure}
    \item Same keypair used, so it is easier to switch between both instances \begin{figure}[!htbp]
                                                                                  \centering
                                                                                  \includegraphics[width=\textwidth]{resources/elb/elb-instance-2-type-and-keypair.png}
                                                                                  \caption{Elastic Load Balancing}
                                                                                  \label{fig:elb-type-and-keypair}
                                                                                \end{figure}
    Network Settings
    \item VPC set to be Group4 VPC  (created in Section~\ref{ch:vpc})
    \item Subnet set to be "Public Subnet 2"
    \item Public IP auto-assigned
    \item Existing security group of "Group4-Security-Group" selected to allow HTTP, HTTPS, SSH and MySQL traffic on the
    instance \begin{figure}[!htbp]
                           \centering
                           \includegraphics[width=\textwidth]{resources/elb/elb-instance-2-network-settings.png}
                           \caption{Elastic Load Balancing}
                           \label{fig:elb-instance-2-network-setting}
                \end{figure}
    \item Storage remains the same as previous instance

    \begin{figure}[!htbp]
        \centering
        \includegraphics[width=\textwidth]{resources/elb/elb-instance-2-storage-config.png}
        \caption{Elastic Load Balancing}
        \label{fig:elb-instance-2-storage}
    \end{figure}
    \item Second instance now created \begin{figure}[!htbp]
                                          \centering
                                          \includegraphics[width=\textwidth]{resources/elb/elb-instance-2-created.png}
                                          \caption{Elastic Load Balancing}
                                          \label{fig:elb-instance-2-create}
                                        \end{figure}
\end{itemize}

2. Creation of target group

Now that there is 2 instances, they both need to be stored within a target group.

\begin{itemize}
    \item The Target Group type of "Instances" is selected - this will store both running instances of Digital-Ink in a group
    to be handled by the Load Balancer (elb/elb-target-group-basic-config)
    \item Target Group name of "Group4-Target-Group" given (elb/elb-target-group-basic-config)
    \item Protocol of HTTP and port 80 given \begin{figure}[!htbp]
                                                 \centering
                                                 \includegraphics[width=\textwidth]{resources/elb/elb-basic-config.png}
                                                 \caption{Elastic Load Balancing}
                                                 \label{fig:elb-basic-config}
                                            \end{figure}
    \item Group4-VPC selected \begin{figure}[!htbp]
                                  \centering
                                  \includegraphics[width=\textwidth]{resources/elb/elb-vpc.png}
                                  \caption{Elastic Load Balancing}
                                  \label{fig:elb-vpc}
    \end{figure}
    \item The next screen asks for instances that will be registered to the Target Group to be selected
    \item The 2 running instances of Digital Ink are shown and added as targets through the "Include as pending below"
    button \begin{figure}[!htbp]
                         \centering
                         \includegraphics[width=\textwidth]{resources/elb/elb-register-targets.png}
                         \caption{Elastic Load Balancing}
                         \label{fig:elb-register-targets}
                \end{figure}
    \item Target group now created, and contains both EC2 instances within them \begin{figure}[!htbp]
                                                                                    \centering
                                                                                    \includegraphics[width=\textwidth]{resources/elb/elb-target-group-created.png}
                                                                                    \caption{Elastic Load Balancing}
                                                                                    \label{fig:elb-target-group-create}
    \end{figure}
\end{itemize}

3. Creation of Load Balancer

\begin{itemize}
    \item The Target groups are not associated with a Load Balancer, so one will be created as an Application Load Balancer
    \begin{figure}[!htbp]
        \centering
        \includegraphics[width=\textwidth]{resources/elb/elb-load-balancer-creation.png}
        \caption{Elastic Load Balancing}
        \label{fig:elb-load-bal-create}
    \end{figure}
    \item Given the name of "Group4-Load-Balancer' \begin{figure}[!htbp]
                                                       \centering
                                                       \includegraphics[width=\textwidth]{resources/elb/elb-target-group-basic-config.png}
                                                       \caption{Elastic Load Balancing}
                                                       \label{fig:elb-target-group-basic-config}
    \end{figure}
    \item Set to be internet facing and will handle IPv4 addresses \begin{figure}[!htbp]
                                                                       \centering
                                                                       \includegraphics[width=\textwidth]{resources/elb/elb-network-mapping.png}
                                                                       \caption{Elastic Load Balancing}
                                                                       \label{fig:elb-networ-mapping}
    \end{figure}
    \item The security group of Group4-Security-Group is selected, which allows HTTP, HTTPS, SSH and MySQL traffic within
    the load balancer (elb/elb-security-groups-and-listeners)
    \item In the event that either of the web apps goes down, it will be forwarded to the Group4-Target-Group, which will then
    display the available instance \begin{figure}[!htbp]
                                                 \centering
                                                 \includegraphics[width=\textwidth]{resources/elb/elb-security-groups-and-listeners.png}
                                                 \caption{Elastic Load Balancing}
                                                 \label{fig:elb-security-groups}
    \end{figure}
    \item Could not create Global Accelerator due to permissions issue (Future improvement)
    \begin{figure}[!htbp]
        \centering
        \includegraphics[width=\textwidth]{resources/elb/elb-accelerator.png}
        \caption{Elastic Load Balancing}
        \label{fig:elb-accelerators}
    \end{figure}
    \item Summary

    \begin{figure}[!htbp]
        \centering
        \includegraphics[width=\textwidth]{resources/elb/elb-summary.png}
        \caption{Elastic Load Balancing}
        \label{fig:elb-summary}
    \end{figure}


    \item Load balancer created
    \begin{figure}[!htbp]
        \centering
        \includegraphics[width=\textwidth]{resources/elb/elb-created.png}
        \caption{Elastic Load Balancing}
        \label{fig:elb-created}
    \end{figure}

    \item When the load balancer is visited at
    \href{http://http://group4-load-balancer-1914525647.us-east-1.elb.amazonaws.com/}{http://http://group4-load-balancer-1914525647.us-east-1.elb.amazonaws.com/},
    the website is shown
    \begin{figure}[!htbp]
        \centering
        \includegraphics[width=\textwidth]{resources/elb/elb-working.png}
        \caption{Elastic Load Balancing}
        \label{fig:elb-working}
    \end{figure}
\end{itemize}









\begin{figure}[!htbp]
    \centering
    \includegraphics[width=\textwidth]{resources/elb/elb-test-stopped-instance.png}
    \caption{Elastic Load Balancing}
    \label{fig:elb-stopped-instance}
\end{figure}
\begin{figure}[!htbp]
    \centering
    \includegraphics[width=\textwidth]{resources/elb/elb-test-stopped-instance-2.png}
    \caption{Elastic Load Balancing}
    \label{fig:elb-stopped-instance-2}
\end{figure}
